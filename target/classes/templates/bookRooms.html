<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rooms</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
    <style>
        .create-btn {
            background-color: #28a745; /* Set create button background color */
            color: #fff; /* Set create button text color */
            border: none; /* Remove button border */
        }
        .next-btn {
            background-color: #007bff; /* Set next button background color */
            color: #fff; /* Set next button text color */
            border: none; /* Remove button border */
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-center my-4">Rooms</h1>

    <form id="select-rooms-form" action="#">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>Select</th>
                <th>ID</th>
                <th>Room Number</th>
                <th>Image</th>
                <th>Room Type</th>
                <th>Capacity</th>
                <th>Rate</th>
                <th>Description</th>
                <th>Cost</th>
                <th>Services</th> <!-- New column for Services -->
            </tr>
            </thead>
            <tbody>
            <tr th:each="room : ${rooms}">
                <td>
                    <input class="form-check-input" type="checkbox" th:id="'roomCheckbox_' + ${room.roomId}" th:value="${room.roomId}" name="roomIds">
                </td>
                <td th:text="${room.roomId}"></td>
                <td th:text="${room.roomNumber}"></td>
                <td>
                    <img th:src="@{'/imagesForRooms/' + ${room.roomImagePath}}" alt="..." width="100">
                </td>
                <td th:text="${room.roomType}"></td>
                <td th:text="${room.roomCapacity}"></td>
                <td>
                    <!-- Display rate as stars -->
                    <span th:each="star : ${#numbers.sequence(1, room.roomRate)}">
                        <i class="fas fa-star"></i>
                    </span>
                </td>
                <td th:text="${room.roomDescription}"></td>
                <td th:text="${room.roomCost}"></td>
                <td>
                    <!-- Iterate over the list of services for the room -->
                    <ul>
                        <li th:each="service : ${room.services}" th:text="${service.serviceName}"></li>
                    </ul>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="text-center">
            <button type="button" id="next-step-btn" class="btn btn-primary next-btn">Next Step</button>
        </div>
    </form>

    <div id="step-2" style="display: none;">
        <!-- Step 2: Fill in Dates and Person's Name -->
        <h2 class="text-center my-4">Step 2: Fill in Dates and Person's Name</h2>
        <form id="reservation-form" th:action="@{/reservations/createReservationUser}" method="post">
            <div class="mb-3">
                <label for="startDate" class="form-label">Start Date</label>
                <input type="text" class="form-control" id="startDate" name="startDate" required>
                <div class="invalid-feedback">Start date is required</div>
            </div>
            <div class="mb-3">
                <label for="endDate" class="form-label">End Date</label>
                <input type="text" class="form-control" id="endDate" name="endDate" required>
                <div class="invalid-feedback">End date is required</div>
            </div>
            <button type="submit" class="btn btn-primary create-btn">Create Reservation</button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
<script>
    document.getElementById('next-step-btn').addEventListener('click', function() {
        // Hide step 1
        document.getElementById('select-rooms-form').style.display = 'none';
        // Show step 2
        document.getElementById('step-2').style.display = 'block';

        // Get the form element
        var form = document.getElementById('reservation-form');

        // Get all checked checkboxes
        var checkedCheckboxes = document.querySelectorAll('input[name="roomIds"]:checked');

        // Remove any previously added hidden inputs
        var hiddenInputs = document.querySelectorAll('input[type="hidden"][name="roomIds"]');
        hiddenInputs.forEach(function(input) {
            input.remove();
        });

        // Create hidden inputs for each checked checkbox
        checkedCheckboxes.forEach(function(checkbox) {
            var hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'roomIds';
            hiddenInput.value = checkbox.value;
            form.appendChild(hiddenInput);
        });
    });
</script>
<script>
    $(function() {
        // Initialize datepicker for start and end dates
        $("#startDate, #endDate").datepicker({
            dateFormat: 'yy-mm-dd', // Format the date as desired
            minDate: 0, // Set the minimum selectable date to today
            onSelect: function(selectedDate) {
                var option = this.id == "startDate" ? "minDate" : "maxDate",
                    instance = $(this).data("datepicker"),
                    date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings);
                $("#startDate, #endDate").not(this).datepicker("option", option, date);
            }
        });
    });
</script>

</body>
</html>
